@{
    ViewBag.Title = "Chat";
    Layout = null;
}
<h2>Chat</h2>
<div class="container">
    <label>@ViewBag.domainName</label>
    <input type="text" id="message" />
    <input type="button" id="JoinRoomA" value="Room A" />
    <input type="button" id="JoinRoomB" value="Room B" />

    <input type="button" id="sendmessageA" value="Send" />
    <input type="button" id="sendmessageB" value="Send" />

    <input type="hidden" id="displayname" />
    <ul id="discussion">
    </ul>
</div>

<!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/jquery.signalR-2.4.1.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<!--SignalR script to update the chat page and send messages.-->
<script>
    var UserID = @((Session["User"] as ELearning_V2.Models.TaiKhoan) != null ? (Session["User"] as ELearning_V2.Models.TaiKhoan).ID:0)
        $(function () {
            if (UserID != 0) {
                var chat = $.connection.chatHub;
                console.log(chat);
                // Create a function that the hub can call back to display messages.
                chat.client.addChatMessage = function (name, message) {
                    // Add the message to the page.
                    $('#discussion').append('<li><strong>' + htmlEncode(name)
                        + '</strong>: ' + htmlEncode(message) + '</li>');
                };
                chat.client.CreateConnect = function () {
                    // Add the message to the page.
                    chat.server.SaveUser(UserID);
                };
                // Get the user name and store it to prepend to messages.
                // Set initial focus to message input box.
                $('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#JoinRoomA').click(function () {
                        chat.server.joinRoom("RoomA");
                    });
                    $('#JoinRoomB').click(function () {
                        chat.server.joinRoom("RoomB");
                    });
                    $('#sendmessageA').click(function () {
                        // Call the Send method on the hub.
                        chat.server.send("RoomA", $('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                    $('#sendmessageB').click(function () {
                        // Call the Send method on the hub.
                        chat.server.send("RoomB", $('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                });

            }
        // Reference the auto-generated proxy for the hub.
    });
    // This optional function html-encodes messages for display in the page.
    function htmlEncode(value) {
        var encodedValue = $('<div />').text(value).html();
        return encodedValue;
    }
</script>
